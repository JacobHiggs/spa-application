<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>SPA Auth0 Example</title>
</head>

<body>
  <h1>Welcome</h1>
  <button id="login">Log In</button>
  <button id="logout" style="display:none;">Log Out</button>
  <pre id="user"></pre>

  <script type="module">
    import { createAuth0Client } from 'https://cdn.jsdelivr.net/npm/@auth0/auth0-spa-js@2.0.4/+esm';

    const auth0Client = await createAuth0Client({
      domain: "jacoblogin.acmetest.org",
      authorizationParams: {
        client_id: "Sflii0gup2Gjg65gsmj6Yfrs737BbVml",
        redirect_uri: "https://jacobhiggs.github.io/spa-application/"
      }
    });

    if (window.location.search.includes("code=") && window.location.search.includes("state=")) {
      await auth0Client.handleRedirectCallback();
      window.history.replaceState({}, document.title, "/spa-application/");
    }

    const isAuthenticated = await auth0Client.isAuthenticated();
    if (isAuthenticated) {
      const user = await auth0Client.getUser();
      document.getElementById("user").textContent = JSON.stringify(user, null, 2);
      document.getElementById("login").style.display = "none";
      document.getElementById("logout").style.display = "block";
    }

    document.getElementById("login").addEventListener("click", () => {
      auth0Client.loginWithRedirect();
    });

    document.getElementById("logout").addEventListener("click", () => {
      auth0Client.logout({ logoutParams: { returnTo: "https://jacobhiggs.github.io/spa-application/" } });
    });
  </script>
</body>

</html>
